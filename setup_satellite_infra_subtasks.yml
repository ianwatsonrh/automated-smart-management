---
# https://devpress.csdn.net/cicd/62ec1d2689d9027116a10320.html
- name: Deploy satellite_infra workloads
  block:
  - name: Increment retry count
    set_fact:
      retry_count: "{{ 0 if retry_count is undefined else retry_count | int + 1 }}"
  - name: Resume failed Satellite tasks after each failed attempt
    import_playbook: satellite_hammer_task_resume.yml

  - name: deploy satellite_infra workloads
    include_role:
      name: "{{ satellite_infra_vars }}"
    loop: "{{ satellite_infra_workloads }}"
    loop_control:
      loop_var: satellite_infra_vars

  rescue:
    - fail:
        msg: Maximum retries of grouped tasks reached
      when: retry_count | int == 5

    - debug:
        msg: "Task Group failed, let's give it another shot"

    - include_task: setup_satellite_infra_subtasks.yml
...